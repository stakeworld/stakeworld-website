"use strict";(self.webpackChunkstakeworld=self.webpackChunkstakeworld||[]).push([[602],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>y});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=r.createContext({}),p=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=p(a),y=n,m=u["".concat(l,".").concat(y)]||u[y]||c[y]||o;return a?r.createElement(m,i(i({ref:t},d),{},{components:a})):r.createElement(m,i({ref:t},d))}));function y(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var p=2;p<o;p++)i[p]=a[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},5607:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var r=a(3117),n=(a(7294),a(3905));const o={id:"intro",title:"Setting up a validator node",description:"Setting up a validator node",slug:"/validate",sidebar_position:1},i=void 0,s={unversionedId:"validate/intro",id:"validate/intro",title:"Setting up a validator node",description:"Setting up a validator node",source:"@site/docs/validate/intro.mdx",sourceDirName:"validate",slug:"/validate",permalink:"/docs/validate",draft:!1,editUrl:"https://github.com/stakeworld/website/edit/master/docs/validate/intro.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"intro",title:"Setting up a validator node",description:"Setting up a validator node",slug:"/validate",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Validate",permalink:"/docs/category/validate"},next:{title:"Paritydb snapshots",permalink:"/docs/snapshot"}},l={},p=[{value:"Setup a server",id:"setup-a-server",level:2},{value:"Firewall",id:"firewall",level:2},{value:"Packages",id:"packages",level:2},{value:"Install polkadot",id:"install-polkadot",level:2},{value:"Systemctl service scripts",id:"systemctl-service-scripts",level:2},{value:"Database sync",id:"database-sync",level:2},{value:"Snapshot providers",id:"snapshot-providers",level:3}],d={toc:p};function c(e){let{components:t,...o}=e;return(0,n.kt)("wrapper",(0,r.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"Setting up a validator is a lot of fun but also a lot of work")),(0,n.kt)("h2",{id:"setup-a-server"},"Setup a server"),(0,n.kt)("p",null,"First you will need a working server setup. We advise an ubuntu 20.04 LTS on dedicated ",(0,n.kt)("a",{parentName:"p",href:"./hardware"},"hardware")),(0,n.kt)("p",null,"The ",(0,n.kt)("a",{parentName:"p",href:"https://wiki.polkadot.network/docs/maintain-guides-how-to-validate-kusama"},"polkadot wiki")," also has a lot of good information about seting up a validator node. "),(0,n.kt)("p",null,"It is wise to start setting your hostname (preferably matched bij the reverse dns on your provider), copying your ssh keys to your server and disable plain password authentication."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"vi /etc/hostname\n")),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"yourhostname.yourhostdomain")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"vi /etc/ssh/sshd_config\n")),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"PasswordAuthentication no")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl restart sshd.service\n")),(0,n.kt)("h2",{id:"firewall"},"Firewall"),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"Polkadot needs some ports open in the firewall, especially the p2p port"),(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},"30333: p2p port"),(0,n.kt)("li",{parentName:"ul"},"9933: HTTP RPC"),(0,n.kt)("li",{parentName:"ul"},"9944: WS RPC"),(0,n.kt)("li",{parentName:"ul"},"9615: prometheus port"))),(0,n.kt)("p",null,"If you open a range of ports you can choose to run a second validator or change ports in your systemctl config."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"ufw allow openssh\nufw enable\nufw allow from any port 30300:30399 proto tcp\n")),(0,n.kt)("h2",{id:"packages"},"Packages"),(0,n.kt)("p",null,"Optionally lock the kernel updates so you have to manually upgrade them (which requires a restart)"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"apt-mark hold linux-generic linux-headers-generic linux-image-generic\n")),(0,n.kt)("h2",{id:"install-polkadot"},"Install polkadot"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"# Import the security@parity.io GPG key\ngpg --recv-keys --keyserver hkps://keys.mailvelope.com 9D4B2B6EB8F97156D19669A9FF0812D491B96798\ngpg --export 9D4B2B6EB8F97156D19669A9FF0812D491B96798 > /usr/share/keyrings/parity.gpg\n# Add the Parity repository and update the package index\necho 'deb [signed-by=/usr/share/keyrings/parity.gpg] https://releases.parity.io/deb release main' > /etc/apt/sources.list.d/parity.list\napt update\n# Install the `parity-keyring` package - This will ensure the GPG key\n# used by APT remains up-to-date\napt install parity-keyring\n# Install polkadot\napt install polkadot\n")),(0,n.kt)("h2",{id:"systemctl-service-scripts"},"Systemctl service scripts"),(0,n.kt)("p",null,"By default there is a ",(0,n.kt)("inlineCode",{parentName:"p"},"/usr/lib/systemd/system/polkadot.service")," systemctl script which reads its defaults from ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/default/polkadot"),"."),(0,n.kt)("p",null,"Below an adapted systemctl script. It gives the possibility for different ports, if you run more instances you need to adapt the ports and base directories alongside the \u201cDescription\u201d in the .service file."),(0,n.kt)("p",null,"You can download it here: ",(0,n.kt)("a",{target:"_blank",href:a(9418).Z},(0,n.kt)("code",null,"yourvalidator.service"))," and copy it to ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/systemd/system/"),"."),(0,n.kt)("p",null,"After you have installed your adapted service you can start and enable it by"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl daemon-reload\nsystemctl start yourvalidator.service\nsystemctl enable yourvalidator.service\njournalctl -u yourvalidator.service -f\n")),(0,n.kt)("h2",{id:"database-sync"},"Database sync"),(0,n.kt)("p",null,"If you fire up a fresh polkadot it starts to sync from scratch, which will take a while."),(0,n.kt)("p",null,"Using an up to date database you can speed up the process. Best is to shortly start the relevant polkadot binary, so the file structure gets created, then stop it and execute the code below. After this you can start the binary and it will only need a short period to sync and start validating."),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"There are different size databases, a \u201cpruned\u201d database is sufficient for a validator node.")),(0,n.kt)("h3",{id:"snapshot-providers"},"Snapshot providers"),(0,n.kt)("p",null,"Stakeworld hosts a pruned snapshot in paritydb format for quick deployment, you can find details ",(0,n.kt)("a",{parentName:"p",href:"./snapshot"},"here"),". There are also other providers like ",(0,n.kt)("a",{parentName:"p",href:"https://polkashots.io/"},"polkashots.io")," and ",(0,n.kt)("a",{parentName:"p",href:"https://polkachu.com/snapshots"},"polkachu.com"),"."))}c.isMDXComponent=!0},9418:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/files/yourvalidator-8ac07a1dc6bbb7efa5d8fba7964fadd6.service"}}]);